import { defineConfig } from 'vite';

// https://vitejs.dev/config
export default defineConfig({
    resolve: {
        // Some libs that can run in both Web and Node.js, such as `axios`, we need to tell Vite to build them in Node.js.
        // browserField: false,
        mainFields: ['module', 'jsnext:main', 'jsnext'],
    },
    build: {
        //     rollupOptions: {
        //         external: ['url', 'path', 'fs', 'fs/promises'],
        //     },
        // },
        rollupOptions: {
            external: [
                'node:util',
                'node:buffer',
                'node:stream',
                'node:net',
                'node:url',
                'node:fs',
                'node:path',
                'util',
                'buffer',
                'stream',
                'net',
                'url',
                'fs',
                'path',
                'perf_hooks',
            ],
            output: {
                globals: {
                    'node:stream': 'stream',
                    'node:buffer': 'buffer',
                    'node:util': 'util',
                    'node:net': 'net',
                    'node:url': 'url',
                    perf_hooks: 'perf_hooks',
                },
                inlineDynamicImports: true,
            },
            onwarn(warning, warn) {
                if (warning.code === 'MODULE_LEVEL_DIRECTIVE') {
                  return
                }
                warn(warning)
              }
        },
    },
});
