# This is a basic workflow to help you get started with Actions

name: Lint

# Controls when the workflow will run
on:
  schedule:
    - cron: '*/15 * * * *'
  pull_request:
    branches: ['*']
    types:
      - opened
      - synchronize
      - closed
  push:
    branches: [main]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  black:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: psf/black@stable
        with:
          options: '--check --verbose'
          src: './backend'
  pylint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python 3.9
        uses: actions/setup-python@v1
        with:
          python-version: 3.9
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - run: pylint backend/ --output-format=colorized --disable="C,R"
  eslint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js 14.x
        uses: actions/setup-node@v1
        with:
          node-version: 14.x
        # Node v14 comes with npm@6.x by default.
        # This version of npm does NOT install peer deps by default which is required by some of our deps
      - run: npm i -g npm@7
      - run: npm ci
      - run: npm run lint-js
  typescript:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js 14.x
        uses: actions/setup-node@v1
        with:
          node-version: 14.x
      - run: npm i -g npm@7
      - run: npm ci
      - run: npx tsc
